{% extends "plantilla.html" %}
{% load static %}

{% block title %}
    Carga Masiva de Datos | SIAPE
{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'CSS/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="main-content"> 
    
    <nav class="dashboard-nav">
        <a href="{% url 'dashboard_director' %}" class="nav-item">
            <i class="fas fa-user-tie"></i>
            Panel Principal
        </a>
        <a href="{% url 'casos_generales' %}" class="nav-item">
            <i class="fas fa-folder-open"></i>
            Casos
        </a>
        <a href="{% url 'estadisticas_director' %}" class="nav-item">
            <i class="fas fa-chart-bar"></i>
            Estadísticas
        </a>
        <a href="{% url 'carreras_director' %}" class="nav-item">
            <i class="fas fa-graduation-cap"></i>
            Mis Carreras
        </a>
        <a href="{% url 'gestion_asignaturas_director' %}" class="nav-item">
            <i class="fas fa-book"></i>
            Asignaturas
        </a>
        <a href="{% url 'gestion_carga_masiva_director' %}" class="nav-item active">
            <i class="fas fa-file-upload"></i>
            Carga Masiva
        </a>
    </nav>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="info-banner">
        <h2><i class="fas fa-cloud-upload-alt"></i> Carga Masiva de Datos</h2>
        <p>
            Aquí puedes subir archivos Excel (.xlsx) para cargar estudiantes, docentes, asignaturas e inscripciones de forma masiva.
            Descarga las plantillas para ver el formato correcto de cada archivo.
        </p>
    </div>

    <div class="carreras-info">
        <h4><i class="fas fa-info-circle"></i> Tus Carreras Asignadas</h4>
        <div class="carreras-list">
            {% for carrera in carreras %}
                <span class="carrera-badge">{{ carrera.nombre }} (ID: {{ carrera.id }})</span>
            {% empty %}
                <span style="color: #dc3545;">No tienes carreras asignadas</span>
            {% endfor %}
        </div>
    </div>

    <div class="upload-section">
        
        <!-- Carga de Estudiantes -->
        <div class="upload-card">
            <h3><i class="fas fa-user-graduate"></i> Cargar Estudiantes</h3>
            <p>Sube un archivo Excel con los datos de los estudiantes de tus carreras.</p>
            
            <div class="columns-info">
                <strong>Columnas requeridas:</strong><br>
                <code>RUT</code>, <code>Nombres</code>, <code>Apellidos</code>, <code>Email</code><br>
                <strong>Opcionales:</strong> <code>Telefono</code>, <code>Carrera_ID</code>
            </div>
            
            <form method="post" action="{% url 'cargar_estudiantes_excel' %}" enctype="multipart/form-data" class="upload-form">
                {% csrf_token %}
                <div class="file-input-wrapper">
                    <input type="file" name="archivo_excel" accept=".xlsx,.xls" required>
                </div>
                <button type="submit" class="upload-btn">
                    <i class="fas fa-upload"></i> Subir Estudiantes
                </button>
            </form>
            
            <div class="card-footer">
                <a href="{% url 'descargar_plantilla_excel' 'estudiantes' %}" class="download-btn">
                    <i class="fas fa-download"></i> Descargar Plantilla
                </a>
            </div>
        </div>

        <!-- Carga de Docentes -->
        <div class="upload-card">
            <h3><i class="fas fa-chalkboard-teacher"></i> Cargar Docentes</h3>
            <p>Sube un archivo Excel para crear cuentas de docentes en el sistema.</p>
            
            <div class="columns-info">
                <strong>Columnas requeridas:</strong><br>
                <code>RUT</code>, <code>Nombres</code>, <code>Apellidos</code>, <code>Email</code><br>
                <strong>Opcionales:</strong> <code>Password</code> (si no se especifica, se genera automáticamente)
            </div>
            
            <form method="post" action="{% url 'cargar_docentes_excel' %}" enctype="multipart/form-data" class="upload-form">
                {% csrf_token %}
                <div class="file-input-wrapper">
                    <input type="file" name="archivo_excel" accept=".xlsx,.xls" required>
                </div>
                <button type="submit" class="upload-btn">
                    <i class="fas fa-upload"></i> Subir Docentes
                </button>
            </form>
            
            <div class="card-footer">
                <a href="{% url 'descargar_plantilla_excel' 'docentes' %}" class="download-btn">
                    <i class="fas fa-download"></i> Descargar Plantilla
                </a>
            </div>
        </div>

        <!-- Carga de Asignaturas -->
        <div class="upload-card">
            <h3><i class="fas fa-book"></i> Cargar Asignaturas</h3>
            <p>Sube un archivo Excel con las asignaturas y sus docentes asignados.</p>
            
            <div class="columns-info">
                <strong>Columnas requeridas:</strong><br>
                <code>Nombre</code>, <code>Seccion</code><br>
                <strong>Opcionales:</strong> <code>Carrera_ID</code>, <code>Docente_RUT</code> o <code>Docente_Email</code>
            </div>
            
            <form method="post" action="{% url 'cargar_asignaturas_excel' %}" enctype="multipart/form-data" class="upload-form">
                {% csrf_token %}
                <div class="file-input-wrapper">
                    <input type="file" name="archivo_excel" accept=".xlsx,.xls" required>
                </div>
                <button type="submit" class="upload-btn">
                    <i class="fas fa-upload"></i> Subir Asignaturas
                </button>
            </form>
            
            <div class="card-footer">
                <a href="{% url 'descargar_plantilla_excel' 'asignaturas' %}" class="download-btn">
                    <i class="fas fa-download"></i> Descargar Plantilla
                </a>
            </div>
        </div>

        <!-- Carga de Inscripciones -->
        <div class="upload-card">
            <h3><i class="fas fa-user-plus"></i> Inscribir Estudiantes en Asignaturas</h3>
            <p>Sube un archivo Excel para inscribir estudiantes en las asignaturas que cursan.</p>
            
            <div class="columns-info">
                <strong>Columnas requeridas:</strong><br>
                <code>Estudiante_RUT</code>, <code>Asignatura_Nombre</code>, <code>Asignatura_Seccion</code>
            </div>
            
            <form method="post" action="{% url 'cargar_inscripciones_excel' %}" enctype="multipart/form-data" class="upload-form">
                {% csrf_token %}
                <div class="file-input-wrapper">
                    <input type="file" name="archivo_excel" accept=".xlsx,.xls" required>
                </div>
                <button type="submit" class="upload-btn">
                    <i class="fas fa-upload"></i> Subir Inscripciones
                </button>
            </form>
            
            <div class="card-footer">
                <a href="{% url 'descargar_plantilla_excel' 'inscripciones' %}" class="download-btn">
                    <i class="fas fa-download"></i> Descargar Plantilla
                </a>
            </div>
        </div>

    </div>

</div>
{% endblock %}

